<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PetCare - Cadastro</title>
    <link rel="stylesheet" href="../public/css/styleCadastro.css">
    <link rel="icon" href="../public/assets/icone aba.png" class="icone">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,300;0,400;0,600;0,700;0,800;0,900&display=swap"
        rel="stylesheet">

    <style>
        img:hover {
            transform: scale(1.1);
        }
    </style>
</head>

<body>
    <header>
        <div class="logo">
         <img src="../public/assets/freepik-modern-minimalist-healthy-food-restaurant-logo-20240929232453cwc6.png" alt="">
        </div>
         <a href="../public/index.html">HOME</a>
         <a href="#sobre">SOBRE</a>
         <a href="#servicos">SERVIÇOS</a>
         <a href="../public/calculadora.html">PETCÁLCULO</a>
         <a href="../public/LOGINPETCARE.html">LOGIN</a>
         <a href="../public/cadastro.html"><span>CADASTRO</span></a>
 
       
     </header>
 


    <div class="container">
        
        <div class="painel">
            <b>
                <h1>Cadastrar</h1>
            </b>
            <span>Razão Social:</span>
            <input oninput="razao()" id="input_razao" class="input_cadastro" type="text" placeholder="Digite o nome da empresa">
            <div class="razao_validar" id="div_razao"></div> 
            
            <span>CNPJ:</span>
            <input id="input_cnpj" oninput="cnpj()" class="input_cadastro" type="number" placeholder="Digite o CNPJ da empresa">
            <div class="cnpj_validar" id="div_cnpj"></div>

            <span>CEP:</span>
            <input id="input_cep" oninput="cep()" class="input_cadastro" type="text" placeholder="Digite o nome da empresa">
            <div class="cep_validar" id="div_cep"></div>

            <span>Telefone:</span>
            <input oninput="telefone()" id="input_telefone" class="input_cadastro" type="number" placeholder="Digite o telefone da empresa">
            <div class="telefone_validar" id="div_telefone"></div>

            <span>Email:</span>
            <input oninput="email()" id="input_email"class="input_cadastro"  type="text" placeholder="Digite seu email">
            <div class="email_validar" id="div_email"></div>

            <span>Senha:</span>
            <input oninput="analisar()" id="input_senha" class="input_cadastro" type="password" placeholder="Digite sua senha">
            <div class="mensagem" id="div_mensagem"></div>

            <span>Confirme sua senha:</span>
            <input oninput="confirmar()" id="confirmar_senha" class="input_cadastro" type="password"
                placeholder="Confirme sua senha">
            <div class="confirmar_senha" id="confirmar_mensagem"></div>

            <br>
            <button onclick="cadastrar()" class="botao">Cadastrar</button>
            <div class="cadastro_link">
                Tem uma conta?<a href="../LOGIN/LOGINPETCARE.html"><br><b>Inicie sessão</b></a>
            </div>
        </div>
    </div>



    <footer>
        <div class="icone">
            <img src="../public/assets/instagram.png" alt="">
            <img src="../public/assets/facebook.png" alt="">
            <img src="../public/assets/twitter.png" alt="">
        </div>
        <div class="icone">
            <img src="../public/assets/icons8-carta-37 (1).png" alt="">
           
            <p>petcare@sptech.school</p>
        </div>
        <div class="icone">
            <a href="https://wa.me/5511998508868" target="_blank">
                <img src="../public/assets/zap.png" alt="">
            </a>
            <p>(11) 99850-8868</p>
        </div>
    </footer>

</body>

</html>
<script>

  // Array para armazenar empresas cadastradas para validação de código de ativação 
  let listaEmpresasCadastradas = [];

  function cadastrar() {
    // aguardar();

    //Recupere o valor da nova input pelo nome do id
    // Agora vá para o método fetch logo abaixo
    var razaoVar = input_razao.value;
    var cnpjlVar = input_cnpj.value;
    var cepVar = input_cep.value
    var telefoneVar = input_telefone.value;
    var emailVar = input_email.value;
    var senhaVar = input_senha.value;
    var confirmacaoVar = confirmar_senha.value;


//     // variaveis de validação de texto
//     var tamanhoNome = nomeVar.length;
//     var emailArroba = emailVar.indexOf('@');
//     var tamanhoSenha = senhaVar.length;
//     var tamanhoCpf = cpfVar.length;
//     // Verificando se há algum campo em branco
//     if (
//       nomeVar == "" ||
//       emailVar == "" ||
//       cpfVar == "" ||
//       senhaVar == "" ||
//       confirmacaoSenhaVar == "" ||
//       codigoVar == ""
//     ) {
//       cardErro.style.display = "block";
//       mensagem_erro.innerHTML =
//         "(Mensagem de erro para todos os campos em branco)";

//       finalizarAguardar();
//       return false;
//     }else  {
//       setInterval(sumirMensagem, 5000);
//     }
// // validação dos campos
//     if(tamanhoNome <= 1 ||
//             emailArroba == -1 ||
//             tamanhoSenha <= 6 ||
//             senhaVar != senhaVar||
//             tamanhoCpf == 11  
//     ){
//       cardErro.style.display = "block";
//       mensagem_erro.innerHTML =
//       `Mensagem de erro, campos não validados!<br>
//       O nome tem que ser maior que 1!<br>
//       O email tem que ter Arroba '@'!<br>
//       O cpf tem que conter 11 numeros!<br>
//       E a senha tem que ser igual no confirmar senha!`;

//       finalizarAguardar();
//       return false;
//     } else{
//       setInterval(sumirMensagem, 5000);
//     }

//     // Verificando se o código de ativação é de alguma empresa cadastrada
//     for (let i = 0; i < listaEmpresasCadastradas.length; i++) {
//       if (listaEmpresasCadastradas[i].codigo_ativacao == codigoVar) {
//         idEmpresaVincular = listaEmpresasCadastradas[i].id
//         console.log("Código de ativação válido.");
//         break;
//       } else {
//         cardErro.style.display = "block";
//         mensagem_erro.innerHTML = "(Mensagem de erro para código inválido)";
//         finalizarAguardar();
//       }
//     }

    // Enviando o valor da nova input
    fetch("/usuarios/cadastrar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/usuario.js
        razaoServer:razaoVar,
        cnpjlServer:cnpjlVar,
        cepServer:cepVar,
        telefoneServer:telefoneVar,
        emailServer:emailVar,
        senhaServer:senhaVar,
        confirmarServer: confirmacaoVar,
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
          cardErro.style.display = "block";

          mensagem_erro.innerHTML =
            "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

          setTimeout(() => {
            window.location = "login.html";
          }, "2000");

          limparFormulario();
          finalizarAguardar();
        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        finalizarAguardar();
      });

    return false;
  }

//   // Listando empresas cadastradas 
//   function listar() {
//     fetch("/empresas/listar", {
//       method: "GET",
//     })
//       .then(function (resposta) {
//         resposta.json().then((empresas) => {
//           empresas.forEach((empresa) => {
//             listaEmpresasCadastradas.push(empresa);

//             console.log("listaEmpresasCadastradas")
//             console.log(listaEmpresasCadastradas[0].codigo_ativacao)
//           });
//         });
//       })
//       .catch(function (resposta) {
//         console.log(`#ERRO: ${resposta}`);
//       });
//   }

//   function sumirMensagem() {
//     cardErro.style.display = "none";
//   }
//         function cadastrar(){
//             var razao = input_razao.value;
//             var cnpj = input_cnpj.value
//             var cep = input_cep.value
//             var telefone = input_telefone.value
//             var
//         }
    
//     fetch("/empresa/cadastrar", {
//       method: "POST",
//       headers: {
//         "Content-Type": "application/json",
//       },
//       body: JSON.stringify({
//         // crie um atributo que recebe o valor recuperado aqui
//         // Agora vá para o arquivo routes/usuario.js
//         nomeServer: nomeVar,
//         emailServer: emailVar,
//         senhaServer: senhaVar,
//         cpfServer: cpfVar,
//         idEmpresaVincularServer: idEmpresaVincular
//       }),
//     })

</script>